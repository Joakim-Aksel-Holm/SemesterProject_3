@page "/operator"
@using BeerProduction.Services
@inject DatabaseConnection Db
@inject NavigationManager NavigationManager
@rendermode InteractiveServer
@using System.Timers
@implements IDisposable

<link rel="stylesheet" href="css/operatorStyle.css"/>


    <div class="machine-view">
    
    <div class="machine-inventory">
        <ol class="ordered-queue">
        
            <li class="queue-item" >
            <h4 class="BatchId"> BatchId </h4>
            <p>Status: venter</p> 
            </li>


            <li class="queue-item">
            <h4 class="BatchId">BatchId</h4>
            <p>Status: Venter</p>
            </li>

            <li class="queue-item">
            <h4 class="BatchId">BatchId</h4>
            <p>Status: Venter</p>
            </li>
        </ol>
    </div>
    <div class="machine-meter">
        <div class="variables">
            <ul>
                <li>
                    <img class="VaribaleLogo" src="../assets/VariablesLogo/Batch.jpg" alt="Batch" > 
                    <span>
                        @MachineControlService.GetBatchId()
                    </span>
                </li>
                <li>
                    <img class="VaribaleLogo" src="../assets/VariablesLogo/Temperature.jpg" alt="Temperature" > 
                    <span>
                        @MachineControlService.GetTemperature()
                        
                        Temperature: 38
                    </span>
                </li>
                <li>
                    <img class="VaribaleLogo" src="../assets/VariablesLogo/Humidity.jpg" alt="Humidity"> 
                    <span>
                        @MachineControlService.GetHumidity()
                        Humidity
                    </span>
                </li>
                <li>
                    <img class="VaribaleLogo" src="../assets/VariablesLogo/AmountToProduce.jpg" alt="Amount to produce">
                    <span>
                        @MachineControlService.GetAmount()
                        Amount to produce
                    </span>
                </li>
                <li>
                    <img class="VaribaleLogo" src="../assets/VariablesLogo/Produced.jpg" alt="Produced" > 
                    <span>
                        @MachineControlService.GetProduced()
                        Produced
                    </span>
                </li>
                <li>
                    <img class="VaribaleLogo" src="../assets/VariablesLogo/AcceptableProducts.jpg" alt="Acceptable Products" > 
                    <span>
                        @MachineControlService.GetAcceptable()
                        Acceptable products
                    </span>
                </li>
                <li>
                    <img class="VaribaleLogo" src="../assets/VariablesLogo/DefectProduct.jpg" alt="Defect Products"> 
                    <span>
                        @MachineControlService.GetDefects()
                        Defect products
                    </span>
                </li>
                <li>
                    <img class="VaribaleLogo" src="../assets/VariablesLogo/SuccesRate.jpg" alt=" Succesrate"> 
                    <span>
                        @MachineControlService
                        Succesrate
                    </span>
                </li>
            </ul>

        </div>
    </div>
    <div class="Machine-bottom">
        
        <div class="ButtonAlert">
            <button class="AlertButton">
                ALERT
            </button>

        </div>
        
        

    </div>
</div>

@code {
    [Parameter] public MachineControlService MachineControlService { get; set; } = default!;

    private Timer? _refreshTimer;
    
    protected override void OnInitialized()
    {
        // Start with Temperature and Batch Progress selected
        
        _refreshTimer = new Timer(200);
        _refreshTimer.Elapsed += async (_, _) => await OnTimerElapsed();
        _refreshTimer.AutoReset = true;
        _refreshTimer.Enabled = true;
    }

    private async Task OnTimerElapsed()
    {
        await InvokeAsync(StateHasChanged);
    }

    public void Dispose()
    {
        _refreshTimer.Stop();
        _refreshTimer.Dispose();
    }

}